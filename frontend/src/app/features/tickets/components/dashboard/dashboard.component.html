<div class="dashboard-container">
  <!-- Campo di ricerca -->
  <div class="filter-container mb-2">
    <div class="row g-2 align-items-end">
      <!-- Filtro per testo -->
      <div class="col-md-6">
        <label for="textInput" class="form-label">Filtra per testo</label>
        <input type="text" class="form-control" id="textInput" placeholder="Inserisci testo"
          (keyup)="applyFilter(textInput.value, selectedStatus)" #textInput />
      </div>

      <!-- Filtro per stato -->
      <div class="col-md-6">
        <label class="form-label">Filtra per stato</label>
        <div class="dropdown w-100">
          <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button"
            data-bs-toggle="dropdown" aria-expanded="false">
            Seleziona stati
          </button>
          <ul class="dropdown-menu w-100 p-2" style="max-height: 200px; overflow-y: auto;">
            <li>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="selectAll" (change)="toggleSelectAll($event)"
                  [checked]="selectedStatus.length === availableStatus.length" />
                <label class="form-check-label" for="selectAll">
                  Seleziona tutto
                </label>
              </div>
            </li>
            <li *ngFor="let status of availableStatus">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" [id]="'status-' + status" [value]="status"
                  [checked]="selectedStatus.includes(status)" (change)="onCheckboxChange($event)" />
                <label class="form-check-label" [for]="'status-' + status">
                  {{ getTicketStatusEnumValue(status) }}
                </label>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- tabella -->
  <div class="table-responsive table-container">
    <table class="table table-bordered table-hover align-middle">
      <thead class="">
        <tr>
          <th *ngFor="let col of displayedColumns" (click)="sortData(col)" class="sortable"
            [ngClass]="{ active: sortColumn === col }">
            {{ getColumnHeader(col) }}
            <span *ngIf="sortColumn === col">
              {{ sortDirection === 'asc' ? '▲' : '▼' }}
            </span>
          </th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let ticket of paginatedTickets" [ngClass]="{ 'highlight-row': isViewingTicket(ticket) }"
          (click)="onRowClick($event, ticket)" (mousedown)="onRowClick($event, ticket)"
          (contextmenu)="onRowClick($event, ticket)" style="cursor: pointer">
          <td *ngFor="let col of displayedColumns">
            <ng-container *ngIf="col !== 'status'; else statusTpl">
              {{ columnAccessors[col](ticket) }}
            </ng-container>
            <ng-template #statusTpl>
              <span [appStatusClass]="ticket.status">
                {{ getTicketStatusEnumValue(ticket.status) }}
              </span>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <nav *ngIf="totalPages > 1">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1" (click)="changePage(currentPage - 1)">
        <a class="page-link" href="javascript:void(0)">«</a>
      </li>

      <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index"
        [class.active]="currentPage === i + 1" (click)="changePage(i + 1)">
        <a class="page-link" href="javascript:void(0)">{{ i + 1 }}</a>
      </li>

      <li class="page-item" [class.disabled]="currentPage === totalPages" (click)="changePage(currentPage + 1)">
        <a class="page-link" href="javascript:void(0)">»</a>
      </li>
    </ul>
  </nav>
</div>
